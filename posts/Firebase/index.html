<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="FCM(Firebase Cloud Messaging)" /><meta name="author" content="seyoung" /><meta property="og:locale" content="en" /><meta name="description" content="푸시 서비스 사용하기" /><meta property="og:description" content="푸시 서비스 사용하기" /><link rel="canonical" href="https://sey2.github.io/posts/Firebase/" /><meta property="og:url" content="https://sey2.github.io/posts/Firebase/" /><meta property="og:site_name" content="Se Young" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-02-07T00:24:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="FCM(Firebase Cloud Messaging)" /><meta name="twitter:site" content="@" /><meta name="twitter:creator" content="@seyoung" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"seyoung"},"dateModified":"2022-02-07T01:46:25+09:00","datePublished":"2022-02-07T00:24:00+09:00","description":"푸시 서비스 사용하기","headline":"FCM(Firebase Cloud Messaging)","mainEntityOfPage":{"@type":"WebPage","@id":"https://sey2.github.io/posts/Firebase/"},"url":"https://sey2.github.io/posts/Firebase/"}</script><title>FCM(Firebase Cloud Messaging) | Se Young</title><link rel="apple-touch-icon" sizes="200x200" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="42x42" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="26x26" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Se Young"><meta name="application-name" content="Se Young"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/profile.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Se Young</a></div><div class="site-subtitle font-italic">CS, Android, etc .. diary</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/sey2" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['casio2978','naver.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>FCM(Firebase Cloud Messaging)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>FCM(Firebase Cloud Messaging)</h1><div class="post-meta text-muted"><div> By <em> <a href="https://instagram.com/casio2978">Se Young Park</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-02-07 00:24:00 +0900" data-toggle="tooltip" data-placement="bottom" title="Mon, Feb 7, 2022, 12:24 AM +0900" >Feb 7, 2022</em> </span> <span> Updated <em class="timeago" date="2022-02-07 01:46:25 +0900 " data-toggle="tooltip" data-placement="bottom" title="Mon, Feb 7, 2022, 1:46 AM +0900" >Feb 7, 2022</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3562 words"> <em>19 min</em> read</span></div></div></div><div class="post-content"><h2 id="푸시-서비스-사용하기">푸시 서비스 사용하기<a href="#푸시-서비스-사용하기" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>안드로이드 스마트폰을 사용하다 보면 Play 스토어나 앱 마켓에서 설치한 앱의 업데이트가 있다는 알람이 종종 울린다. 단말의 위쪽 부분에 보이는 상태 바 부분에 메시지가 표시되면 사용자는 업데이트 여부를 결정하게 된다.</p><p>업데이트 메시지는 어떻게 표시되는 걸까?</p><p>단말로 메시지를 보내는 방법에는 세 가지 방법이 있다.</p><ul><li><p><strong>단순 SMS를 이용한 알림</strong> -&gt; 간단하지만 비용이 발생할 수 있다.</p><li><strong>앱과 서버를 연결한 알림</strong> -&gt; 앱에서 서버와의 연결을 만들어놓고 폴링하는 과정이 필요하며 백그라운드 서비스를 이용해 연결을 유지      해야 하므로 간단하지 않다.<li><strong>구글의 푸시 서비스(FCM)를 사용하여 알림</strong> -&gt; 구글의 클라우드 서비스를 사용해 메시지 전송 방식을 최적화한 서비스 방식 -&gt; 앱에서 서버로 직접 연결할 필요가 없으며 단말의 내부 연결을 공유하여 메시지를 수신하는 방식</ul><p>세 번째 푸시 서비스는 <strong>FCM(Firebase Cloud Messaging)</strong> 이라고 불린다.</p><p>FCM은 앱 사용자에게 포그라운드 상태 (앱 실행 중)나 백그라운드(앱 실행 x) 상태나 알림을 보낼 수 있다.</p><p>푸시 서비스란 ‘업데이트가 있습니다.’ 와 같은 메시지를 <strong>구글 클라우드 서버에서 구글 Play 스토어가 설치된 단말기로 보내는 방식이다.</strong></p><p>이 푸시 서비스를 사용하는 각각의 앱은 구글 클라우드 서버에 직접 연결하지 않는다. 그 이유는 단말에서 연결을 유지하고 있기 때문이다.</p><p>만약 위 구글 서비스를 사용하지 않고 직접 구현하려면 단말에서 서버로 연결을 유지하면서 동시에 연결을 지속적으로 유지해야 한다. 따라서 일정 시간 간격으로 연결이 끊어졌는지 검사하는 <strong>Polling</strong> 메커니즘을 구현해야한다</p><p>하지만 폴링 기능을 구현하게 되면 그 과정에서 단말의 하드웨어 리소스나 전원을 많이 소모하는 문제가 발생하게 된다. 결국 구글에서 제공하는 <strong>FCM</strong>을 사용하는 것이 효과적으로 푸시 메시지를 보낼 수 있는 방법이 된다.</p><p><img data-src="https://user-images.githubusercontent.com/54762273/152680182-7f8672ce-15de-4638-9695-de29a24473bd.png" alt="Untitled Diagram drawio" data-proofer-ignore/></p><p><strong>FCM 푸시 메시지 처리 과정</strong></p><p><strong>1. 단말은 자신을 클라우드 서버에 등록하고 서버로부터 등록 id를 받는다.</strong> <strong>2. 등록 ID는 메시지 전송을 담당할 애플리케이션 서버로 보낸 후 메시지를 기다린다.</strong> <strong>3. 보내려는 메시지는 애플리케이션 서버에서 클라우드에 접속한 후 전송한다.</strong> <strong>4. 클라우드 서버로 전송된 메시지는 대상 단말에 보내진다.</strong></p><p>기본적으로 푸시 메시지를 받으려면 클라우드 서버에 자신의 단말이 등록되어 있어야 한다. 단말 등록 과정에서 등록 id를 받게 되고 푸시 메시지를 보내는 쪽에서 상대방의 등록 id를 사용해야 메시지를 보낼 수 있다. 등록 id는 전송 허가서와 같은 역할을 하는셈이다.</p><p>보통 웹 서버에 푸시 메시지를 전송하는 기능을 추가하여 구성하는 경우가 많다.</p><p>이 어플리케이션 서버는 직접 단말로 메시지를 보낼 수 없으므로 클라우드 서버를 통해 보내게 된다. 즉, <strong>어플리케이션 서버 -&gt; 클라우드서버 -&gt; 단말</strong> 형태를 띠게 된다.</p><p>위 과정은 다음과 같은 두 가지 내용을 알아야한다.</p><p><strong>1. 어플리케이션 서버에 저장된 단말의 등록 id</strong> <strong>2. 어플리케이션 서버에서 클라우드 서버로 접속하기 위한 인증 정보</strong></p><p><strong>첫 번째는 단말의 등록 id이다.</strong></p><p>푸시 메시지를 보내기 위해서는 어플리케이션 서버가 어떤 단말로 메시지를 보내 줄 것인지에 대한 정보가 필요하게 된다.</p><p>이 등록 id는 등록한 단말별로 고유한 값이 되므로 어플리케이션 서버에 저장되며, 클라우드 서버가 메시지를 보내주어야 할 단말을 구분하는데 사용된다.</p><p><strong>두 번째로 클라우드 서버로 접속하기 위한 인증 정보이다.</strong></p><p>메시지를 전송할 때도 아무나 접속하여 단말 메시지를 보내면 안되므로 애플리케이션 서버가 API 키라는 고유한 값을 포함하여 메시지를 보내도록 한다.</p><p>이 인증 정보는 어떤 사람이 어떤 서비스에 사용하는지 구별하기 위한 것이므로 개발자가 만드는 애플리케이션을 FCM 사이트에 등록해야 사용할 수 있다.</p><hr /><h3 id="예제">예제<a href="#예제" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p><strong>FCM 설정 페이지에서 프로젝트 만들기</strong></p><p>FCM을 사용하려면 FCM 설정 페이지에서 프로젝트를 새로 만들어야 한다.</p><p>FCM은 여러 구글 서비스 중 하나인 Firebase에 통합되어 있어 Firebase 개발자 콘솔 페이지에서 새로운 프로젝트를 만들거나 설정할 수 있다.</p><p>아래 홈페이지에 들어가 프로젝트를 만들어주자.</p><p><a href="https://console.firebase.google.com"> Firebase 개발자 콘솔 페이지 </a></p><p><img data-src="https://user-images.githubusercontent.com/54762273/152681029-ae013d9f-34c3-443c-9b1e-9d36ae70ae4a.PNG" alt="1" data-proofer-ignore/></p><p><img data-src="https://user-images.githubusercontent.com/54762273/152681035-c46d4024-3407-4f1f-ac2a-c6446f1b839f.PNG" alt="2" data-proofer-ignore/></p><p><img data-src="https://user-images.githubusercontent.com/54762273/152681045-875f8ce7-f85a-4577-8de9-8db2f4260e60.PNG" alt="3" data-proofer-ignore/></p><p><img data-src="https://user-images.githubusercontent.com/54762273/152681061-c66e5a85-5b0d-4e2a-9c9b-49fd8a18969c.PNG" alt="4" data-proofer-ignore/></p><p><strong>안드로이드 아이콘을 클릭</strong></p><p><img data-src="https://user-images.githubusercontent.com/54762273/152681072-ab1d3b7f-9313-4ea4-b9b3-80e64eca7b53.PNG" alt="5" data-proofer-ignore/></p><p>다운로드를 해서 프로젝트의 app 폴더에 넣어준다.</p><p><img data-src="https://user-images.githubusercontent.com/54762273/152681076-d44b5804-5b29-4a40-a616-a84a69faf71d.PNG" alt="6" data-proofer-ignore/></p><p><img data-src="https://user-images.githubusercontent.com/54762273/152681081-b497e98c-550a-4ffe-ad41-70b8d50e90e4.PNG" alt="7" data-proofer-ignore/></p><p>이렇게 하면 성공적으로 프로젝트가 만들어진다.</p><p><strong>인제 FCM 사용을 위해 추가 설정을 해주자.</strong></p><p><strong>build.gradle(Project:SamplePath)</strong></p><div class="language-xml highlighter-rouge"><div class="code-header"> <span label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>dependencies {  
	classpath 'com.google.gms:google-services:4.3.10'  
}
</pre></table></code></div></div><p>위의 클래스 패치를 추가해 준다.</p><p><strong>build.gradle(Module:SamplePath)</strong></p><div class="language-xml highlighter-rouge"><div class="code-header"> <span label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>plugins {  
  id 'com.android.application'  
  id 'com.google.gms.google-services'  
}

</pre></table></code></div></div><div class="language-xml highlighter-rouge"><div class="code-header"> <span label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>dependencies {  
  implementation platform('com.google.firebase:firebase-bom:29.0.4')  
  implementation 'com.google.firebase:firebase-analytics'
  implementation 'com.google.firebase:firebase-messaging:21.1.0'
</pre></table></code></div></div><p>플러그인과 의존성을 추가해준다.</p><p>위의 29.0.4 같은 숫자들은 프로젝트를 언제 만들었는지에 따라 달라지므로 개발자 콘솔 페이지에 있는 설명글을 확인해서 넣어주자.</p><p><strong>이렇게 하면 FCM를 사용할 때 필요한 기본적인 설정이 끝난다.</strong></p><p><strong>FCM을 사용하려면 앱 프로젝트 안에 두 개의 서비스를 만들어야 한다.</strong></p><p>첫 번째 서비스 파일을 만들어 보자.</p><p><strong>프로젝트 창의 왼쪽 프로젝트 영역에서 app를 선택한 후 오른쪽 마우스를 클릭</strong> <strong>[New -&gt; Service -&gt; Service] 메뉴를 누른다.</strong> <strong>대화 상자가 표시되면 Class Name 입력 상자에 MyFirebaseMessagingService를 입력한다.</strong></p><p><strong>MyFirebaseMessagingService.class</strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">org.techtown.push</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.app.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Context</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.IBinder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.util.Log</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.google.firebase.messaging.FirebaseMessagingService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.firebase.messaging.RemoteMessage</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyFirebaseMessagingService</span> <span class="kd">extends</span> <span class="nc">FirebaseMessagingService</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">MyFirebaseMessagingService</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onNewToken</span><span class="o">(</span><span class="nc">String</span> <span class="n">token</span><span class="o">){</span>   <span class="c1">// 새로운 토큰을 확인했을 때 호출되는 메서드</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onNewToken</span><span class="o">(</span><span class="n">token</span><span class="o">);</span>    <span class="c1">// token은 앱의 등록 id를 의미</span>
        <span class="nc">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">"FMS"</span><span class="o">,</span> <span class="s">"onNewToken 호출됨: "</span> <span class="o">+</span> <span class="n">token</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span> <span class="c1">// 푸시 메시지를 받았을 떄 그 내용 확인한 후 액티비티 쪽으로 보내는 메서드 호출</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onMessageReceived</span><span class="o">(</span><span class="nc">RemoteMessage</span> <span class="n">remoteMessage</span><span class="o">){</span> <span class="c1">// 새로운 메시지를 받았을 때 호출되는 메서드</span>
        <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"FMS"</span><span class="o">,</span> <span class="s">"onMessageReceived 호출됨."</span><span class="o">);</span>

        <span class="nc">String</span> <span class="n">from</span> <span class="o">=</span> <span class="n">remoteMessage</span><span class="o">.</span><span class="na">getFrom</span><span class="o">();</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">remoteMessage</span><span class="o">.</span><span class="na">getData</span><span class="o">();</span>
        <span class="nc">String</span> <span class="n">contents</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"contents"</span><span class="o">);</span>

        <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"FMS"</span><span class="o">,</span> <span class="n">from</span> <span class="o">+</span> <span class="s">", contents : "</span> <span class="o">+</span> <span class="n">contents</span><span class="o">);</span>
        <span class="n">sendToActivity</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="n">from</span><span class="o">,</span> <span class="n">contents</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// 액티비티 쪽으로 데이터를 보내기 위해 인텐트 객체를 만들고 startActivity 메서드 호출</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">sendToActivity</span><span class="o">(</span><span class="nc">Context</span> <span class="n">context</span><span class="o">,</span> <span class="nc">String</span> <span class="n">from</span><span class="o">,</span> <span class="nc">String</span> <span class="n">contents</span><span class="o">){</span>
        <span class="nc">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="nc">MainActivity</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">intent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"from"</span><span class="o">,</span> <span class="n">from</span><span class="o">);</span>
        <span class="n">intent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"contents"</span><span class="o">,</span> <span class="n">contents</span><span class="o">);</span>

        <span class="n">intent</span><span class="o">.</span><span class="na">addFlags</span><span class="o">(</span><span class="nc">Intent</span><span class="o">.</span><span class="na">FLAG_ACTIVITY_NEW_TASK</span> <span class="o">|</span>
                        <span class="nc">Intent</span><span class="o">.</span><span class="na">FLAG_ACTIVITY_SINGLE_TOP</span><span class="o">|</span>
                        <span class="nc">Intent</span><span class="o">.</span><span class="na">FLAG_ACTIVITY_CLEAR_TOP</span><span class="o">);</span>

        <span class="n">context</span><span class="o">.</span><span class="na">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p>위와 같이 수정한다.</p><p>구글 클라우드 서버에서 보내오는 메시지는 위 클래스에서 받을 수 있으며, 메시지가 도착하면 <code class="language-plaintext highlighter-rouge">onMessageReceived</code> 메서드가 자동으로 호출된다.</p><p>따라서 <code class="language-plaintext highlighter-rouge">onMessageReceived</code> 메서드를 재정의하면 구글 클라우드 서버에서 보내오는 메시지를 받아서 처리할 수 있다.</p><p><code class="language-plaintext highlighter-rouge">onNewToken</code> 메서드는 이 앱이 Firebase 서버에 등록되었을 때 호출된다.</p><p><strong>AndroidManifest.xml</strong> 파일을 열어 인텐트 필터를 갖도록 설정해주고 인터넷 권한을 추가해주자.</p><p><strong>AndroidManifest.xml</strong></p><div class="language-xml highlighter-rouge"><div class="code-header"> <span label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;manifest</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">package=</span><span class="s">"org.techtown.push"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.INTERNET"</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;application</span>
        <span class="na">android:allowBackup=</span><span class="s">"true"</span>
        <span class="na">android:icon=</span><span class="s">"@mipmap/ic_launcher"</span>
        <span class="na">android:label=</span><span class="s">"@string/app_name"</span>
        <span class="na">android:roundIcon=</span><span class="s">"@mipmap/ic_launcher_round"</span>
        <span class="na">android:supportsRtl=</span><span class="s">"true"</span>
        <span class="na">android:theme=</span><span class="s">"@style/Theme.SamplePush"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;service</span>
            <span class="na">android:name=</span><span class="s">".MyFirebaseMessagingService"</span>
            <span class="na">android:enabled=</span><span class="s">"true"</span>
            <span class="na">android:exported=</span><span class="s">"true"</span>
            <span class="na">android:stopWithTask=</span><span class="s">"false"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;intent-filter&gt;</span>
                <span class="nt">&lt;action</span> <span class="na">android:name =</span><span class="s">"com.google.firebase.MESSAGING_EVENT"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/intent-filter&gt;</span>
        <span class="nt">&lt;/service&gt;</span>

        <span class="nt">&lt;activity</span>
            <span class="na">android:name=</span><span class="s">".MainActivity"</span>
            <span class="na">android:exported=</span><span class="s">"true"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;intent-filter&gt;</span>
                <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"android.intent.action.MAIN"</span> <span class="nt">/&gt;</span>

                <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">"android.intent.category.LAUNCHER"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/intent-filter&gt;</span>
        <span class="nt">&lt;/activity&gt;</span>
    <span class="nt">&lt;/application&gt;</span>

<span class="nt">&lt;/manifest&gt;</span>
</pre></table></code></div></div><p>인제 소스 코드에 단말 등록 기능을 추가하자.</p><p><strong>MainActivity.java</strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">org.techtown.push</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">androidx.annotation.NonNull</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">androidx.appcompat.app.AppCompatActivity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.util.Log</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.View</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.Button</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.TextView</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.google.android.gms.tasks.OnCompleteListener</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.android.gms.tasks.Task</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.firebase.iid.FirebaseInstanceIdReceiver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.firebase.installations.FirebaseInstallations</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.firebase.messaging.FirebaseMessaging</span><span class="o">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="nc">AppCompatActivity</span> <span class="o">{</span>
    <span class="nc">TextView</span> <span class="n">textView</span><span class="o">;</span>
    <span class="nc">TextView</span> <span class="n">textView2</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nc">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>

        <span class="n">textView</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">textView</span><span class="o">);</span>
        <span class="n">textView2</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">textView2</span><span class="o">);</span>

        <span class="nc">FirebaseMessaging</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getToken</span><span class="o">()</span> <span class="c1">// 등록 id 확인을 위한 리스너 설정</span>
            <span class="o">.</span><span class="na">addOnCompleteListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">OnCompleteListener</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;()</span> <span class="o">{</span>
                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onComplete</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="nc">Task</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">task</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">if</span><span class="o">(!</span><span class="n">task</span><span class="o">.</span><span class="na">isSuccessful</span><span class="o">()){</span>
                        <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"Main"</span><span class="o">,</span> <span class="s">"토큰 가져오는데 실패"</span><span class="o">,</span> <span class="n">task</span><span class="o">.</span><span class="na">getException</span><span class="o">());</span>
                        <span class="k">return</span><span class="o">;</span>
                    <span class="o">}</span>
                    <span class="nc">String</span> <span class="n">newToken</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="na">getResult</span><span class="o">();</span>
                    <span class="n">println</span><span class="o">(</span><span class="s">"등록id : "</span> <span class="o">+</span> <span class="n">newToken</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">});</span>

        <span class="nc">Button</span> <span class="n">button</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button</span><span class="o">);</span>
        <span class="n">button</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="nc">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">Task</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">instanceId</span> <span class="o">=</span> <span class="nc">FirebaseInstallations</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getId</span><span class="o">()</span>
                        <span class="o">.</span><span class="na">addOnCompleteListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">OnCompleteListener</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;()</span> <span class="o">{</span>
                            <span class="nd">@Override</span>
                            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onComplete</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="nc">Task</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">task</span><span class="o">)</span> <span class="o">{</span>
                                <span class="k">if</span> <span class="o">(</span><span class="n">task</span><span class="o">.</span><span class="na">isSuccessful</span><span class="o">())</span> <span class="o">{</span>
                                    <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"Installations"</span><span class="o">,</span> <span class="s">"Installation ID: "</span> <span class="o">+</span> <span class="n">task</span><span class="o">.</span><span class="na">getResult</span><span class="o">());</span>
                                    <span class="n">println</span><span class="o">(</span><span class="s">"확인된 인스턴스 id: "</span> <span class="o">+</span> <span class="n">task</span><span class="o">.</span><span class="na">getResult</span><span class="o">());</span>
                                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                                    <span class="nc">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">"Installations"</span><span class="o">,</span> <span class="s">"Unable to get Installation ID"</span><span class="o">);</span>
                                <span class="o">}</span>
                            <span class="o">}</span>
                        <span class="o">});</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">send</span><span class="o">(</span><span class="nc">String</span> <span class="n">input</span><span class="o">){</span>

    <span class="o">}</span>

    <span class="nd">@Override</span> <span class="c1">// 서비스로부터 인텐트를 받았을 때 처리</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onNewIntent</span><span class="o">(</span><span class="nc">Intent</span> <span class="n">intent</span><span class="o">){</span>
        <span class="n">println</span><span class="o">(</span><span class="s">"onNewIntent 호출됨"</span><span class="o">);</span>

        <span class="k">if</span><span class="o">(</span><span class="n">intent</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
            <span class="n">processIntent</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>

        <span class="kd">super</span><span class="o">.</span><span class="na">onNewIntent</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">processIntent</span><span class="o">(</span><span class="nc">Intent</span> <span class="n">intent</span><span class="o">){</span>
        <span class="nc">String</span> <span class="n">from</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getStringExtra</span><span class="o">(</span><span class="s">"from"</span><span class="o">);</span>

        <span class="k">if</span><span class="o">(</span><span class="n">from</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
            <span class="n">println</span><span class="o">(</span><span class="s">"form is null"</span><span class="o">);</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="c1">// 보낸 데이터는 contents 키를 사용해서 확인</span>
        <span class="nc">String</span> <span class="n">contents</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getStringExtra</span><span class="o">(</span><span class="s">"contents"</span><span class="o">);</span>
        <span class="n">textView</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">"["</span> <span class="o">+</span> <span class="n">from</span> <span class="o">+</span> <span class="s">"]로부터 수신한 데이터: "</span> <span class="o">+</span> <span class="n">contents</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">println</span><span class="o">(</span><span class="nc">String</span> <span class="n">data</span><span class="o">){</span>
        <span class="n">textView2</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">data</span> <span class="o">+</span> <span class="s">"\n"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}}</span>

</pre></table></code></div></div><p>책에서는 인스턴스 등록 id 값을 확인할 때 <strong>FirebaseInstnaceId.getInstance().getId()</strong> 메서드를 사용 하라고 했는데 위의 메서드가 자꾸 인식 오류가 났다.</p><p>원인을 알아 본 결과 위의 방식은 예전 방식이여서 지원하지 않는다고 한다.. -_-</p><p>따라서 <code class="language-plaintext highlighter-rouge">FirebaseInstallations.getInstance().getId()</code>로 확인해야 한다.</p><p><a href="https://firebase.google.com/docs/projects/manage-installations?hl=ko#java_2"> 참고 사이트 </a></p><p>이렇게 하면 푸시 메시지를 받는 앱의 기능이 완성 되었다.</p><p><img data-src="https://user-images.githubusercontent.com/54762273/152686581-bc07882b-9509-4d0c-8ce0-2f83cd7f5ec7.PNG" alt="1" data-proofer-ignore/></p><hr /><h3 id="메시지-전송-앱-만들기">메시지 전송 앱 만들기<a href="#메시지-전송-앱-만들기" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p><strong>SamplePushSend</strong>라는 새 프로젝트를 만들어 준다.</p><p>메시지 전송할때 Volley 라이브러리를 사용할 것이므로 아래와 같이 라이브러리를 추가한다.</p><p><strong>build.gradle(Module: SamplePushSend.app)</strong></p><div class="language-xml highlighter-rouge"><div class="code-header"> <span label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>dependencies {  
  implementation 'com.android.volley:volley:1.2.0'
</pre></table></code></div></div><p><strong>MainActivity.java</strong>를 수정해주자.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">org.techtown.push.send</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.View</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.Button</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.EditText</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.TextView</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">androidx.appcompat.app.AppCompatActivity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.android.volley.AuthFailureError</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.android.volley.Request</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.android.volley.RequestQueue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.android.volley.Response</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.android.volley.VolleyError</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.android.volley.toolbox.JsonObjectRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.android.volley.toolbox.Volley</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.json.JSONArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.json.JSONObject</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="nc">AppCompatActivity</span> <span class="o">{</span>
    <span class="nc">EditText</span> <span class="n">editText</span><span class="o">;</span>
    <span class="nc">TextView</span> <span class="n">textView</span><span class="o">;</span>

    <span class="kd">static</span> <span class="nc">RequestQueue</span> <span class="n">requestQueue</span><span class="o">;</span>
    <span class="kd">static</span> <span class="nc">String</span> <span class="n">regId</span> <span class="o">=</span> <span class="s">"Input Your  Installation ID"</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nc">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>

        <span class="n">editText</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">editText</span><span class="o">);</span>
        <span class="n">textView</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">textView</span><span class="o">);</span>

        <span class="nc">Button</span> <span class="n">button</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button</span><span class="o">);</span>
        <span class="n">button</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="nc">View</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">String</span> <span class="n">input</span> <span class="o">=</span> <span class="n">editText</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
                <span class="n">send</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">requestQueue</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">requestQueue</span> <span class="o">=</span> <span class="nc">Volley</span><span class="o">.</span><span class="na">newRequestQueue</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">());</span>
        <span class="o">}</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">send</span><span class="o">(</span><span class="nc">String</span> <span class="n">input</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 전송 정보를 담아둘 JSONObject 객체 생성</span>
        <span class="nc">JSONObject</span> <span class="n">requestData</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JSONObject</span><span class="o">();</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="n">requestData</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"priority"</span><span class="o">,</span> <span class="s">"high"</span><span class="o">);</span>    <span class="c1">// 옵션 추가</span>

            <span class="c1">// 전송 할 데이터 추가</span>
            <span class="nc">JSONObject</span> <span class="n">dataObj</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JSONObject</span><span class="o">();</span>
            <span class="n">dataObj</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"contents"</span><span class="o">,</span> <span class="n">input</span><span class="o">);</span>
            <span class="n">requestData</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"data"</span><span class="o">,</span> <span class="n">dataObj</span><span class="o">);</span>

            <span class="c1">// 푸시 메시지를 수신할 단말 등록 ID를 JSONArray에 추가한 후 requestData 객체에 추가</span>
            <span class="nc">JSONArray</span> <span class="n">idArray</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JSONArray</span><span class="o">();</span>
            <span class="n">idArray</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">regId</span><span class="o">);</span>
            <span class="n">requestData</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"registration_ids"</span><span class="o">,</span> <span class="n">idArray</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="n">sendData</span><span class="o">(</span><span class="n">requestData</span><span class="o">,</span> <span class="k">new</span> <span class="nc">SendResponseListener</span><span class="o">()</span> <span class="o">{</span>  <span class="c1">// 푸쉬 전송을 위해 정의한 메서드 호출</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onRequestCompleted</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">println</span><span class="o">(</span><span class="s">"onRequestCompleted() 호출됨."</span><span class="o">);</span>
            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onRequestStarted</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">println</span><span class="o">(</span><span class="s">"onRequestStarted() 호출됨."</span><span class="o">);</span>
            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onRequestWithError</span><span class="o">(</span><span class="nc">VolleyError</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">println</span><span class="o">(</span><span class="s">"onRequestWithError() 호출됨."</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">SendResponseListener</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onRequestStarted</span><span class="o">();</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onRequestCompleted</span><span class="o">();</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onRequestWithError</span><span class="o">(</span><span class="nc">VolleyError</span> <span class="n">error</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sendData</span><span class="o">(</span><span class="nc">JSONObject</span> <span class="n">requestData</span><span class="o">,</span> <span class="kd">final</span> <span class="nc">SendResponseListener</span> <span class="n">listener</span><span class="o">)</span> <span class="o">{</span>

        <span class="c1">// Volley 요청 객체를 만들고 요청을 위한 데이터 설정, 두 번째 매개 변수는 클라우드 서버의 요청 주소</span>
        <span class="nc">JsonObjectRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JsonObjectRequest</span><span class="o">(</span>

                <span class="nc">Request</span><span class="o">.</span><span class="na">Method</span><span class="o">.</span><span class="na">POST</span><span class="o">,</span> <span class="s">"https://fcm.googleapis.com/fcm/send"</span><span class="o">,</span> <span class="n">requestData</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Response</span><span class="o">.</span><span class="na">Listener</span><span class="o">&lt;</span><span class="nc">JSONObject</span><span class="o">&gt;()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResponse</span><span class="o">(</span><span class="nc">JSONObject</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">listener</span><span class="o">.</span><span class="na">onRequestCompleted</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">},</span> <span class="k">new</span> <span class="nc">Response</span><span class="o">.</span><span class="na">ErrorListener</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onErrorResponse</span><span class="o">(</span><span class="nc">VolleyError</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">listener</span><span class="o">.</span><span class="na">onRequestWithError</span><span class="o">(</span><span class="n">error</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">})</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">protected</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="nf">getParams</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">AuthFailureError</span> <span class="o">{</span>
                <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;();</span>
                <span class="k">return</span> <span class="n">params</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="nf">getHeaders</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">AuthFailureError</span> <span class="o">{</span>
                <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">headers</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;();</span>
                <span class="n">headers</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"Authorization"</span><span class="o">,</span> <span class="s">"key= Input Your API KEY"</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">headers</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getBodyContentType</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">return</span> <span class="s">"application/json"</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">};</span>

        <span class="n">request</span><span class="o">.</span><span class="na">setShouldCache</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
        <span class="n">listener</span><span class="o">.</span><span class="na">onRequestStarted</span><span class="o">();</span>
        <span class="n">requestQueue</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">println</span><span class="o">(</span><span class="nc">String</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">textView</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">data</span> <span class="o">+</span> <span class="s">"\n"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">getHeader</code> 메서드 안의 key값은 FCM 개발자 콘솔 페이지에서 확인할 수 있다.</p><p><strong>프로젝트 설정 -&gt; 서버 키</strong> 복사해서 넣으면 된다.</p><p><strong>regId 변수의 값은 Firebase 클라이언트 식별자 id 값이다.</strong></p><p>마지막으로 인터넷 권한을 추가해주면 끝난다.</p><p><strong>AndroidManifest.xml</strong></p><div class="language-xml highlighter-rouge"><div class="code-header"> <span label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>  
<span class="nt">&lt;manifest</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>  
  <span class="na">package=</span><span class="s">"org.techtown.push.send"</span><span class="nt">&gt;</span>  
  
 <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.INTERNET"</span><span class="nt">/&gt;</span>
</pre></table></code></div></div><p><img data-src="https://user-images.githubusercontent.com/54762273/152687885-314ae763-8995-4952-9158-99a9dd6ff79e.PNG" alt="3" data-proofer-ignore/> <img data-src="https://user-images.githubusercontent.com/54762273/152687871-eb29f890-35e5-4022-a5d4-425791230aeb.PNG" alt="2" data-proofer-ignore/></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/android/'>Android</a>, <a href='/categories/pushservice/'>PushService</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/android/" class="post-tag no-text-decoration" >android</a> <a href="/tags/pushservice/" class="post-tag no-text-decoration" >pushservice</a> <a href="/tags/firebase/" class="post-tag no-text-decoration" >firebase</a> <a href="/tags/alerm/" class="post-tag no-text-decoration" >alerm</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=FCM(Firebase Cloud Messaging) - Se Young&url=https://sey2.github.io/posts/Firebase/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=FCM(Firebase Cloud Messaging) - Se Young&u=https://sey2.github.io/posts/Firebase/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=FCM(Firebase Cloud Messaging) - Se Young&url=https://sey2.github.io/posts/Firebase/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div><script src="https://utteranc.es/client.js" repo="sey2/sey2.github.io" issue-term="pathname" theme="github-dark" crossorigin="anonymous" async> </script></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/basic4/">코틀린 기본 문법 (함수)</a><li><a href="/posts/back-13565/">백준 침투</a><li><a href="/posts/back-18352/">특정 거리의 도시 찾기 (18352)</a><li><a href="/posts/programmers-exam/">프로그래머스 모의고사</a><li><a href="/posts/programmers-rotto/">프로그래머스 로또의 최고 순위와 최저 순위</a></ul></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/vibrator/"><div class="card-body"> <em class="timeago small" date="2022-02-06 19:34:00 +0900" >Feb 6, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>진동과 소리로 알려주기</h3><div class="text-muted small"><p> 진동과 소리로 알려주기 사용자에게 무언가를 알려주는 가장 간단한 방법은 진동과 소리이디. 진동은 얼마 동안 울리도록 지정할 수 있으며 Vibrator라는 시스템 서비스 객체를 사용한다. vibrate라는 이름의 메서드가 있어 진동이 울리는 패턴이나 시간을 지정할 수 있다. API public void vibrate (long millseconds...</p></div></div></a></div><div class="card"> <a href="/posts/Notificatoin/"><div class="card-body"> <em class="timeago small" date="2022-02-06 20:22:00 +0900" >Feb 6, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>상단 알림으로 알려주기</h3><div class="text-muted small"><p> 상단 알림으로 알려주기 알림은 화면 상단에 정보를 표시하여 사용자가 알 수 있도록 한다. 이 알림 기능은 주로 다른 사람에게서 메시지를 받았을 때나 단말의 상태를 표시할 때 사용한다. 예를 들어 카카오톡 앱을 직접 만든다면 앱이 실행되지 않은 상태에서도 사용자에게 메시지가 왔다는 것을 알려줄 필요가 있다. 이때 백그라운드에서 동작하는 서비스에서...</p></div></div></a></div><div class="card"> <a href="/posts/Sensor/"><div class="card-body"> <em class="timeago small" date="2022-02-07 02:51:00 +0900" >Feb 7, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>센서</h3><div class="text-muted small"><p> 센서 안드로이드는 다양한 표준 센서를 지원한다. 대표적인 센서 중 하나인 가속 센서 (Accelerometer) 는 다양한 기준 (Axe)을 따라 기기가 얼마 만큼의 속도로 움직이는지 측정할 수 있게 한다. 또한 자이로스코프 센서 (Gyroscope) 는 가속 센서보다 더 많은 축을 기준으로 시간에 따라 회전하는 정보까지 확인 할 수 있도록 해준...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Notificatoin/" class="btn btn-outline-primary" prompt="Older"><p>상단 알림으로 알려주기</p></a> <a href="/posts/Sensor/" class="btn btn-outline-primary" prompt="Newer"><p>센서</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://instagram.com/casio2978">Se Young Park</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/backjoon/">backjoon</a> <a class="post-tag" href="/tags/layout/">layout</a> <a class="post-tag" href="/tags/bfs/">BFS</a> <a class="post-tag" href="/tags/dfs/">DFS</a> <a class="post-tag" href="/tags/programmers/">programmers</a> <a class="post-tag" href="/tags/level1/">level1</a> <a class="post-tag" href="/tags/anroid/">anroid</a> <a class="post-tag" href="/tags/implements/">implements</a> <a class="post-tag" href="/tags/greedy/">greedy</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-M2M35DP38G"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-M2M35DP38G'); }); </script>

<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="카메라에 미리보기 넣기" /><meta name="author" content="seyoung" /><meta property="og:locale" content="en" /><meta name="description" content="카메라에 미리보기 넣기" /><meta property="og:description" content="카메라에 미리보기 넣기" /><link rel="canonical" href="https://sey2.github.io/posts/CameraPreview/" /><meta property="og:url" content="https://sey2.github.io/posts/CameraPreview/" /><meta property="og:site_name" content="Se Young" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-02-02T18:55:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="카메라에 미리보기 넣기" /><meta name="twitter:site" content="@" /><meta name="twitter:creator" content="@seyoung" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"seyoung"},"dateModified":"2022-02-02T18:55:00+09:00","datePublished":"2022-02-02T18:55:00+09:00","description":"카메라에 미리보기 넣기","headline":"카메라에 미리보기 넣기","mainEntityOfPage":{"@type":"WebPage","@id":"https://sey2.github.io/posts/CameraPreview/"},"url":"https://sey2.github.io/posts/CameraPreview/"}</script><title>카메라에 미리보기 넣기 | Se Young</title><link rel="apple-touch-icon" sizes="200x200" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="42x42" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="26x26" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Se Young"><meta name="application-name" content="Se Young"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/profile.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Se Young</a></div><div class="site-subtitle font-italic">CS, Android, etc .. diary</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/sey2" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['casio2978','naver.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>카메라에 미리보기 넣기</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>카메라에 미리보기 넣기</h1><div class="post-meta text-muted"><div> By <em> <a href="https://instagram.com/casio2978">Se Young Park</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-02-02 18:55:00 +0900" data-toggle="tooltip" data-placement="bottom" title="Wed, Feb 2, 2022, 6:55 PM +0900" >Feb 2, 2022</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2341 words"> <em>13 min</em> read</span></div></div></div><div class="post-content"><h2 id="카메라에-미리보기-넣기">카메라에 미리보기 넣기<a href="#카메라에-미리보기-넣기" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>카메라 미리보기 화면에 증강 현실을 표현할 아이콘이나 그래픽 등을 보여주고 싶다면 어떻게 해야할까?</p><p>우리가 만든 앱에 카메라 미리보가와 사진찍기 기능을 넣을 수 있지만 코드는 좀 더 많이지고 <strong>서피스(Surface View)</strong> 라는 것으로 미리보기 화면이 구현되기 때문에 <strong>서피스 뷰가 무엇인지 이해해야 한다.</strong></p><p><img data-src="https://user-images.githubusercontent.com/54762273/152110520-27509f28-82d5-4ff5-9301-4d6d1e9ed3a7.png" alt="Untitled Diagram drawio-3" data-proofer-ignore/></p><p>카메라 미리보기 기능을 구현 하려면 일반 뷰(View)가 아니라 서피스 뷰를 사용해야 한다.</p><p><strong>서피스 뷰는 서피스홀더에 의해 제어 된다.</strong></p><p>만약 카메라 객체를 만든 후 미리보기 화면을 서피스 뷰에 보여주고 싶다면 <strong>서피스 홀더</strong> 객체의 <strong>setPreviewDisplay</strong> 메서드로 미리 보기를 설정해 주어야 한다.</p><p><strong>API</strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPreviewDisplay</span> <span class="o">(</span><span class="nc">Surface</span> <span class="n">sv</span><span class="o">)</span>
</pre></table></code></div></div><p>필요한 초기화 작업이 끝나면 카메라 객체의 <code class="language-plaintext highlighter-rouge">startPreview</code> 메서드를 호출할 수 있으며, 이때부터 입력된 영상을 <strong>서피스 뷰로 화면을 보여주게 된다.</strong></p><hr /><h3 id="예제">예제<a href="#예제" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p><strong>activity_main,xml</strong></p><div class="language-xml highlighter-rouge"><div class="code-header"> <span label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>  
<span class="nt">&lt;LinearLayout</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>  
  <span class="na">xmlns:app=</span><span class="s">"http://schemas.android.com/apk/res-auto"</span>  
  <span class="na">xmlns:tools=</span><span class="s">"http://schemas.android.com/tools"</span>  
  <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>  
  <span class="na">android:layout_height=</span><span class="s">"match_parent"</span>  
  <span class="na">android:orientation=</span><span class="s">"vertical"</span>  
  <span class="na">tools:context=</span><span class="s">".MainActivity"</span><span class="nt">&gt;</span>  
  
    <span class="nt">&lt;Button</span>  
  <span class="na">android:id=</span><span class="s">"@+id/button"</span>  
  <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>  
  <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>  
  <span class="na">android:text=</span><span class="s">"사진 찍기"</span> <span class="nt">/&gt;</span>  
  
    <span class="nt">&lt;FrameLayout</span>  
  <span class="na">android:id=</span><span class="s">"@+id/previewFrame"</span>  
  <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>  
  <span class="na">android:layout_height=</span><span class="s">"match_parent"</span><span class="nt">&gt;</span>  
  
    <span class="nt">&lt;/FrameLayout&gt;</span>  
<span class="nt">&lt;/LinearLayout&gt;</span>
</pre></table></code></div></div><p>카메라 미리보기 화면을 FrameLayout안에 추가하기 위해 소스코드에서 <strong>CameraSufaceView</strong>라는 새로운 클래스를 <strong>MainActivity</strong> 클래스 안에 내부 클래스로 정의하고 그 클래스의 인스턴스 객체를 만들어 추가하자.</p><p>우선 CameraSurfaceVIew 클래스가 있다고 가정하고 메인 액티비트 코드를 작성해보자. <br /></p><p><strong>MainActivity.java</strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="nc">AppCompatActivity</span> <span class="o">{</span>  
    <span class="nc">CameraSurfaceView</span> <span class="n">cameraView</span><span class="o">;</span>  
  
    <span class="nd">@Override</span>  
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nc">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>  
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>  
        <span class="n">setContentView</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>  
  
        <span class="nc">FrameLayout</span> <span class="n">previewFrame</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">previewFrame</span><span class="o">);</span>  
        <span class="n">cameraView</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CameraSurfaceView</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>  
        <span class="n">previewFrame</span><span class="o">.</span><span class="na">addView</span><span class="o">(</span><span class="n">cameraView</span><span class="o">);</span>  
  
        <span class="nc">Button</span> <span class="n">button</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button</span><span class="o">);</span>  
        <span class="n">button</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span>  
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="nc">View</span> <span class="n">v</span><span class="o">){</span>  
                <span class="n">takePicture</span><span class="o">();</span>  
            <span class="o">}</span>  
        <span class="o">});</span>  
    <span class="o">}</span>  
  
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">takePicture</span><span class="o">(){</span>  
        <span class="cm">/* CameraSurfaceView의 capture 메서드 호출하기 */</span>  
			    <span class="n">cameraView</span><span class="o">.</span><span class="na">capture</span><span class="o">(</span><span class="k">new</span> <span class="nc">Camera</span><span class="o">().</span><span class="na">PictureCallback</span><span class="o">()</span> <span class="o">{</span>  
            <span class="k">try</span> <span class="o">{</span>  
                <span class="cm">/* 전달 받은 바이트 배열을 Bitmap 객체로 만들기 */</span>  
			    <span class="nc">Bitmap</span> <span class="n">bitmap</span> <span class="o">=</span> <span class="nc">BitmapFactory</span><span class="o">.</span><span class="na">decodeByteArray</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">data</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>  
                <span class="nc">String</span> <span class="n">outUriStr</span> <span class="o">=</span> <span class="nc">MediaStore</span><span class="o">.</span><span class="na">Images</span><span class="o">.</span><span class="na">Media</span><span class="o">.</span><span class="na">insertImage</span><span class="o">(</span>  
                        <span class="n">getContentResolver</span><span class="o">(),</span>  
                        <span class="n">bitmap</span><span class="o">,</span>  
                        <span class="s">"Caputred Image"</span><span class="o">,</span>  
                        <span class="s">"Caputred Image using Camera."</span><span class="o">);</span>  
  
                <span class="k">if</span> <span class="o">(</span><span class="n">outUriStr</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>  
                    <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"SampleCapture"</span><span class="o">,</span> <span class="s">"Image insert failed."</span><span class="o">);</span>  
                    <span class="k">return</span><span class="o">;</span>  
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>  
                    <span class="nc">Uri</span> <span class="n">outUri</span> <span class="o">=</span> <span class="nc">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">outUriStr</span><span class="o">);</span>  
                    <span class="n">sendBroadcast</span><span class="o">(</span><span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span><span class="nc">Intent</span><span class="o">.</span><span class="na">ACTION_MEDIA_SCANNER_SCAN_FILE</span><span class="o">,</span> <span class="n">outUri</span><span class="o">));</span>  
                <span class="o">}</span>  
  
                <span class="n">camera</span><span class="o">.</span><span class="na">startPreview</span><span class="o">();</span>  
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>  
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>  
            <span class="o">}</span>  
        <span class="o">});</span>  
    <span class="o">}</span>  
  
<span class="o">}</span>

</pre></table></code></div></div><p>카메라 미리보기를 구현하는 CameraSurfaceView는 SurfaceView를 상속받아 새로 정의한 후 XML 레이아웃에 정의된 FameLayout에 추가한다.</p><p>사진 찍기 버튼을 누르면 사진을 한장 찍어 미디어 앨범에 추가하게 되는데 사진을 찍은 결과를 처리하는 코드는 <strong>PictureCallback</strong> 인터페이스를 구현하는 부분에 들어 있다.</p><p><strong>API</strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="n">abstarct</span> <span class="kt">void</span> <span class="nf">onPictureTaken</span> <span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span><span class="o">,</span> <span class="nc">Camera</span> <span class="n">camera</span><span class="o">)</span>
</pre></table></code></div></div><p>즉, 사진을 찍을 때 자동으로 호출되는 <code class="language-plaintext highlighter-rouge">onPictureTaken</code> 메서드로 캡쳐한 이미지 데이터가 전달된다.</p><p>그런 다음 데이터 비트맵으로 만들고 <code class="language-plaintext highlighter-rouge">MediaStore.Images.Media</code>에 정의된 <code class="language-plaintext highlighter-rouge">insertImage</code> 메서드를 이용하여 미디어 앨범에 추가한다.</p><p>이미지 데이터를 비트맵으로 만들기 위해서는 <strong>BitmapFactory</strong> 클래스에 정의된 <code class="language-plaintext highlighter-rouge">decodebyteArray</code> 메서드를 이용한다.</p><p><code class="language-plaintext highlighter-rouge">insertImage</code> 메서드는 간단한 방법으로 이미지를 추가할 수 있도록 정의된 메서드이다.</p><p>자세히 봐보자.</p><p><strong>API</strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="nf">insertImage</span><span class="o">(</span><span class="nc">ContentResolver</span> <span class="n">cr</span><span class="o">,</span> <span class="nc">Bitmap</span> <span class="n">source</span><span class="o">,</span>
									   <span class="nc">String</span> <span class="n">title</span><span class="o">,</span><span class="nc">String</span> <span class="n">description</span><span class="o">)</span>
</pre></table></code></div></div><p>다음은 서피스 뷰를 확장하여 정의한 <strong>CameraSurfaceView 클래스이다.</strong></p><p><strong>이 클래스는 SurfaceHolder에 정의된 Callback 인터페이스를 구현하고 있으므로 서피스 뷰의 상태가 변경될 때 자동으로 호출되는 세가지 메서드 (surfaceCreate, surfaveChanged, surfaceDestoryed)가 구현되어 있다.</strong></p><p>이 클래스는 <strong>MainActivity.java</strong> 클래스 안에 내부 클래스로 정의 한다.</p><p><strong>CameraSurfaceView.java</strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="nc">AppCompatActivity</span> <span class="o">{</span>  
    <span class="nc">CameraSurfaceView</span> <span class="n">cameraView</span><span class="o">;</span>  
  
    <span class="nd">@Override</span>  
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nc">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>  
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>  
        <span class="n">setContentView</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>  
  
        <span class="nc">FrameLayout</span> <span class="n">previewFrame</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">previewFrame</span><span class="o">);</span>  
        <span class="n">cameraView</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CameraSurfaceView</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>  
        <span class="n">previewFrame</span><span class="o">.</span><span class="na">addView</span><span class="o">(</span><span class="n">cameraView</span><span class="o">);</span>  
  
        <span class="nc">Button</span> <span class="n">button</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button</span><span class="o">);</span>  
        <span class="n">button</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span>  
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="nc">View</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>  
                <span class="n">takePicture</span><span class="o">();</span>  
            <span class="o">}</span>  
        <span class="o">});</span>  
  
        <span class="nc">AndPermission</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>  
                <span class="o">.</span><span class="na">runtime</span><span class="o">()</span>  
                <span class="o">.</span><span class="na">permission</span><span class="o">(</span>  
                        <span class="nc">Permission</span><span class="o">.</span><span class="na">CAMERA</span><span class="o">,</span>  
                        <span class="nc">Permission</span><span class="o">.</span><span class="na">READ_EXTERNAL_STORAGE</span><span class="o">,</span>  
                        <span class="nc">Permission</span><span class="o">.</span><span class="na">WRITE_EXTERNAL_STORAGE</span><span class="o">)</span>  
                <span class="o">.</span><span class="na">onGranted</span><span class="o">(</span><span class="k">new</span> <span class="nc">Action</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;&gt;()</span> <span class="o">{</span>  
                    <span class="nd">@Override</span>  
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onAction</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">permissions</span><span class="o">)</span> <span class="o">{</span>  
                        <span class="n">showToast</span><span class="o">(</span><span class="s">"허용된 권한 갯수 : "</span> <span class="o">+</span> <span class="n">permissions</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>  
                    <span class="o">}</span>  
                <span class="o">})</span>  
                <span class="o">.</span><span class="na">onDenied</span><span class="o">(</span><span class="k">new</span> <span class="nc">Action</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;&gt;()</span> <span class="o">{</span>  
                    <span class="nd">@Override</span>  
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onAction</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">permissions</span><span class="o">)</span> <span class="o">{</span>  
                        <span class="n">showToast</span><span class="o">(</span><span class="s">"거부된 권한 갯수 : "</span> <span class="o">+</span> <span class="n">permissions</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>  
                    <span class="o">}</span>  
                <span class="o">})</span>  
                <span class="o">.</span><span class="na">start</span><span class="o">();</span>  
  
    <span class="o">}</span>  
  
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">showToast</span><span class="o">(</span><span class="nc">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>  
        <span class="nc">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">message</span><span class="o">,</span> <span class="nc">Toast</span><span class="o">.</span><span class="na">LENGTH_LONG</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>  
    <span class="o">}</span>  
  
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">takePicture</span><span class="o">()</span> <span class="o">{</span>  
        <span class="n">cameraView</span><span class="o">.</span><span class="na">capture</span><span class="o">(</span><span class="k">new</span> <span class="nc">Camera</span><span class="o">.</span><span class="na">PictureCallback</span><span class="o">()</span> <span class="o">{</span>  
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onPictureTaken</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span><span class="o">,</span> <span class="nc">Camera</span> <span class="n">camera</span><span class="o">)</span> <span class="o">{</span>  
                <span class="k">try</span> <span class="o">{</span>  
                    <span class="nc">Bitmap</span> <span class="n">bitmap</span> <span class="o">=</span> <span class="nc">BitmapFactory</span><span class="o">.</span><span class="na">decodeByteArray</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">data</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>  
                    <span class="nc">String</span> <span class="n">outUriStr</span> <span class="o">=</span> <span class="nc">MediaStore</span><span class="o">.</span><span class="na">Images</span><span class="o">.</span><span class="na">Media</span><span class="o">.</span><span class="na">insertImage</span><span class="o">(</span>  
                            <span class="n">getContentResolver</span><span class="o">(),</span>  
                            <span class="n">bitmap</span><span class="o">,</span>  
                            <span class="s">"Captured Image"</span><span class="o">,</span>  
                            <span class="s">"Captured Image using Camera."</span><span class="o">);</span>  
  
                    <span class="k">if</span> <span class="o">(</span><span class="n">outUriStr</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>  
                        <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"SampleCapture"</span><span class="o">,</span> <span class="s">"Image insert failed."</span><span class="o">);</span>  
                        <span class="k">return</span><span class="o">;</span>  
                    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>  
                        <span class="nc">Uri</span> <span class="n">outUri</span> <span class="o">=</span> <span class="nc">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">outUriStr</span><span class="o">);</span>  
                        <span class="n">sendBroadcast</span><span class="o">(</span><span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span>  
                                <span class="nc">Intent</span><span class="o">.</span><span class="na">ACTION_MEDIA_SCANNER_SCAN_FILE</span><span class="o">,</span> <span class="n">outUri</span><span class="o">));</span>  
                    <span class="o">}</span>  
  
                    <span class="n">camera</span><span class="o">.</span><span class="na">startPreview</span><span class="o">();</span>  
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>  
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>  
                <span class="o">}</span>  
            <span class="o">}</span>  
        <span class="o">});</span>  
    <span class="o">}</span>  
  
  
    <span class="kd">private</span> <span class="kd">class</span> <span class="nc">CameraSurfaceView</span> <span class="kd">extends</span> <span class="nc">SurfaceView</span> <span class="kd">implements</span> <span class="nc">SurfaceHolder</span><span class="o">.</span><span class="na">Callback</span> <span class="o">{</span>  
        <span class="kd">private</span> <span class="nc">SurfaceHolder</span> <span class="n">mHolder</span><span class="o">;</span>  
        <span class="kd">private</span> <span class="nc">Camera</span> <span class="n">camera</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>  
  
        <span class="kd">public</span> <span class="nf">CameraSurfaceView</span><span class="o">(</span><span class="nc">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>  
            <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>  
  
            <span class="n">mHolder</span> <span class="o">=</span> <span class="n">getHolder</span><span class="o">();</span>  
            <span class="n">mHolder</span><span class="o">.</span><span class="na">addCallback</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>  
        <span class="o">}</span>  
  
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getCameraInstance</span><span class="o">(){</span>  
            <span class="k">try</span> <span class="o">{</span>  
                <span class="n">camera</span> <span class="o">=</span> <span class="nc">Camera</span><span class="o">.</span><span class="na">open</span><span class="o">();</span>  
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>  
                <span class="n">showToast</span><span class="o">(</span><span class="s">"카메라가 다른 앱에서 사용중입니다."</span><span class="o">);</span>  
            <span class="o">}</span>  
        <span class="o">}</span>  
  
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">surfaceCreated</span><span class="o">(</span><span class="nc">SurfaceHolder</span> <span class="n">holder</span><span class="o">)</span> <span class="o">{</span>  
            <span class="n">getCameraInstance</span><span class="o">();</span>  
            <span class="n">setCameraOrientation</span><span class="o">();</span>  
  
            <span class="k">try</span> <span class="o">{</span>  
                <span class="n">camera</span><span class="o">.</span><span class="na">setPreviewDisplay</span><span class="o">(</span><span class="n">mHolder</span><span class="o">);</span>  
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>  
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>  
            <span class="o">}</span>  
        <span class="o">}</span>  
  
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">surfaceChanged</span><span class="o">(</span><span class="nc">SurfaceHolder</span> <span class="n">holder</span><span class="o">,</span> <span class="kt">int</span> <span class="n">format</span><span class="o">,</span> <span class="kt">int</span> <span class="n">width</span><span class="o">,</span> <span class="kt">int</span> <span class="n">height</span><span class="o">)</span> <span class="o">{</span>  
            <span class="k">try</span> <span class="o">{</span>  
                <span class="n">camera</span><span class="o">.</span><span class="na">startPreview</span><span class="o">();</span>  
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>  
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>  
            <span class="o">}</span>  
        <span class="o">}</span>  
  
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">surfaceDestroyed</span><span class="o">(</span><span class="nc">SurfaceHolder</span> <span class="n">holder</span><span class="o">)</span> <span class="o">{</span>  
            <span class="k">try</span> <span class="o">{</span>  
                <span class="n">camera</span><span class="o">.</span><span class="na">stopPreview</span><span class="o">();</span>  
                <span class="n">camera</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>  
                <span class="n">camera</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>  
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>  
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>  
            <span class="o">}</span>  
        <span class="o">}</span>  
  
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">capture</span><span class="o">(</span><span class="nc">Camera</span><span class="o">.</span><span class="na">PictureCallback</span> <span class="n">handler</span><span class="o">)</span> <span class="o">{</span>  
            <span class="k">if</span> <span class="o">(</span><span class="n">camera</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>  
                <span class="n">camera</span><span class="o">.</span><span class="na">takePicture</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>  
                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>  
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>  
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>  
            <span class="o">}</span>  
        <span class="o">}</span>  
  
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCameraOrientation</span><span class="o">()</span> <span class="o">{</span>  
            <span class="k">if</span> <span class="o">(</span><span class="n">camera</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>  
                <span class="k">return</span><span class="o">;</span>  
            <span class="o">}</span>  
  
            <span class="nc">Camera</span><span class="o">.</span><span class="na">CameraInfo</span> <span class="n">info</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Camera</span><span class="o">.</span><span class="na">CameraInfo</span><span class="o">();</span>  
            <span class="nc">Camera</span><span class="o">.</span><span class="na">getCameraInfo</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">info</span><span class="o">);</span>  
  
            <span class="nc">WindowManager</span> <span class="n">manager</span> <span class="o">=</span> <span class="o">(</span><span class="nc">WindowManager</span><span class="o">)</span> <span class="n">getSystemService</span><span class="o">(</span><span class="nc">Context</span><span class="o">.</span><span class="na">WINDOW_SERVICE</span><span class="o">);</span>  
            <span class="kt">int</span> <span class="n">rotation</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="na">getDefaultDisplay</span><span class="o">().</span><span class="na">getRotation</span><span class="o">();</span>  
  
            <span class="kt">int</span> <span class="n">degrees</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>  
            <span class="k">switch</span> <span class="o">(</span><span class="n">rotation</span><span class="o">)</span> <span class="o">{</span>  
                <span class="k">case</span> <span class="nc">Surface</span><span class="o">.</span><span class="na">ROTATION_0</span><span class="o">:</span> <span class="n">degrees</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="k">break</span><span class="o">;</span>  
                <span class="k">case</span> <span class="nc">Surface</span><span class="o">.</span><span class="na">ROTATION_90</span><span class="o">:</span> <span class="n">degrees</span> <span class="o">=</span> <span class="mi">90</span><span class="o">;</span> <span class="k">break</span><span class="o">;</span>  
                <span class="k">case</span> <span class="nc">Surface</span><span class="o">.</span><span class="na">ROTATION_180</span><span class="o">:</span> <span class="n">degrees</span> <span class="o">=</span> <span class="mi">180</span><span class="o">;</span> <span class="k">break</span><span class="o">;</span>  
                <span class="k">case</span> <span class="nc">Surface</span><span class="o">.</span><span class="na">ROTATION_270</span><span class="o">:</span> <span class="n">degrees</span> <span class="o">=</span> <span class="mi">270</span><span class="o">;</span> <span class="k">break</span><span class="o">;</span>  
            <span class="o">}</span>  
  
            <span class="kt">int</span> <span class="n">result</span><span class="o">;</span>  
            <span class="k">if</span> <span class="o">(</span><span class="n">info</span><span class="o">.</span><span class="na">facing</span> <span class="o">==</span> <span class="nc">Camera</span><span class="o">.</span><span class="na">CameraInfo</span><span class="o">.</span><span class="na">CAMERA_FACING_FRONT</span><span class="o">)</span> <span class="o">{</span>  
                <span class="n">result</span> <span class="o">=</span> <span class="o">(</span><span class="n">info</span><span class="o">.</span><span class="na">orientation</span> <span class="o">+</span> <span class="n">degrees</span><span class="o">)</span> <span class="o">%</span> <span class="mi">360</span><span class="o">;</span>  
                <span class="n">result</span> <span class="o">=</span> <span class="o">(</span><span class="mi">360</span> <span class="o">-</span> <span class="n">result</span><span class="o">)</span> <span class="o">%</span> <span class="mi">360</span><span class="o">;</span>  
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>  
                <span class="n">result</span> <span class="o">=</span> <span class="o">(</span><span class="n">info</span><span class="o">.</span><span class="na">orientation</span> <span class="o">-</span> <span class="n">degrees</span> <span class="o">+</span> <span class="mi">360</span><span class="o">)</span> <span class="o">%</span> <span class="mi">360</span><span class="o">;</span>  
            <span class="o">}</span>  
  
            <span class="n">camera</span><span class="o">.</span><span class="na">setDisplayOrientation</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>  
        <span class="o">}</span>  
  
    <span class="o">}</span>  
  
<span class="o">}</span>

</pre></table></code></div></div><p><br /></p><p>서피스 뷰가 만들어지면서 호출되는 <code class="language-plaintext highlighter-rouge">surfaceCreated</code> 메서드 안에서는<code class="language-plaintext highlighter-rouge"> Camera.open</code> 메서드를 이용해 카메라를 오픈하고 이를 통해 참조한 카메라 객체에 서피스 홀더 객체를 지정해야 한다.</p><p>카메라 객체에 서피스홀더 객체를 지정하기 위해 <code class="language-plaintext highlighter-rouge">setPreviewDisplay</code> 메서드를 사용한다.서피스뷰의 크기가 변경되거나 할 때 호출되는 <code class="language-plaintext highlighter-rouge">surfaceChanged</code> 메서드 안에서는 <code class="language-plaintext highlighter-rouge">startPreview</code> 메서드를 이용해 미리보기를 시작한다.</p><p>서피스 뷰의 리소스를 해체하면서 호출되는 <code class="language-plaintext highlighter-rouge">surfaceDestroyed</code> 메서드 안에서는 카메라 객체의 <code class="language-plaintext highlighter-rouge">stopPreview</code> 메서드를 호출하여 미리보기를 끝낸 후 변수를 NULL 값으로 지정한다.</p><p>버튼을 클릭했을 때 사진을 찍기 위해 호출하는 caputre 메서드 안을 보면 카메라 객체의 <code class="language-plaintext highlighter-rouge">takePicture</code> 메서드를 호출하여 사진을 찍고 있으며, 이때 PictureCallback 인터페이스를 구현한 객체를 매개변수로 전달함으로써 사진을 찍었을 때 이 객체의 <code class="language-plaintext highlighter-rouge">onPictureTaken</code> 메서드가 자동으로 호출되도록 한다.</p><p>우리가 만드는 앱은 Camera와 SD 카드를 접근하므로 이 권한을 매니페스트에 추가하고 위험권한에 대한 권한 부여를 요청하는 코드를 추가해야 한다.</p><p>먼저 <code class="language-plaintext highlighter-rouge">AndroidManifest.xml</code> 파일을 열고 다음과 같이 권한을 추가한다.</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.CAMERA"</span> <span class="nt">/&gt;</span>  
<span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.WRITE_EXTERNAL_STORAGE"</span> <span class="nt">/&gt;</span>  
<span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.READ_EXTERNAL_STORAGE"</span> <span class="nt">/&gt;</span>  
<span class="nt">&lt;uses-feature</span> <span class="na">android:name=</span><span class="s">"android.hardware.camera"</span> <span class="nt">/&gt;</span>
</pre></table></code></div></div><p>이 권한들은 위험 권한으로 분류 되어 있으므로 자동으로 위험 권한을 부여를 위한 대화상자를 보여주는 코드를 추가한다.</p><p><strong>build.gradle(Module: SampleCaputre.app</strong> 파일을 열고 자동으로 위험 권한을 부여하기 위한 외부 라이브러리를 추가한다.</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>dependencies {  
  ...
  implementation 'com.yanzhenjie:permission:2.0.3'  
}

</pre></table></code></div></div><p>카메라 미리보기의 화면이 세로모드로 보이도록 하고 싶다면 MainActivity 클래스의 내부 클래스로 정의한 <strong>CameraSurfaceView</strong> 클래스 안의 surfaceCreated 메서드를 수정한다.</p><p><br /></p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">surfaceCreated</span><span class="o">(</span><span class="nc">SurfaceHolder</span> <span class="n">holder</span><span class="o">)</span> <span class="o">{</span>  
    <span class="n">camera</span> <span class="o">=</span> <span class="nc">Camera</span><span class="o">.</span><span class="na">open</span><span class="o">();</span>  
    <span class="n">setCameraOrientation</span><span class="o">();</span>  
  
    <span class="k">try</span> <span class="o">{</span>  
        <span class="n">camera</span><span class="o">.</span><span class="na">setPreviewDisplay</span><span class="o">(</span><span class="n">mHolder</span><span class="o">);</span>  
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>  
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>  
    <span class="o">}</span>  
<span class="o">}</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCameraOrientation</span><span class="o">()</span> <span class="o">{</span>  
    <span class="k">if</span> <span class="o">(</span><span class="n">camera</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>  
        <span class="k">return</span><span class="o">;</span>  
    <span class="o">}</span>  
  
    <span class="nc">Camera</span><span class="o">.</span><span class="na">CameraInfo</span> <span class="n">info</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Camera</span><span class="o">.</span><span class="na">CameraInfo</span><span class="o">();</span>  
    <span class="nc">Camera</span><span class="o">.</span><span class="na">getCameraInfo</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">info</span><span class="o">);</span>  
  
    <span class="nc">WindowManager</span> <span class="n">manager</span> <span class="o">=</span> <span class="o">(</span><span class="nc">WindowManager</span><span class="o">)</span> <span class="n">getSystemService</span><span class="o">(</span><span class="nc">Context</span><span class="o">.</span><span class="na">WINDOW_SERVICE</span><span class="o">);</span>  
    <span class="kt">int</span> <span class="n">rotation</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="na">getDefaultDisplay</span><span class="o">().</span><span class="na">getRotation</span><span class="o">();</span>  
  
    <span class="kt">int</span> <span class="n">degrees</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>  
    <span class="k">switch</span> <span class="o">(</span><span class="n">rotation</span><span class="o">)</span> <span class="o">{</span>  
        <span class="k">case</span> <span class="nc">Surface</span><span class="o">.</span><span class="na">ROTATION_0</span><span class="o">:</span> <span class="n">degrees</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="k">break</span><span class="o">;</span>  
        <span class="k">case</span> <span class="nc">Surface</span><span class="o">.</span><span class="na">ROTATION_90</span><span class="o">:</span> <span class="n">degrees</span> <span class="o">=</span> <span class="mi">90</span><span class="o">;</span> <span class="k">break</span><span class="o">;</span>  
        <span class="k">case</span> <span class="nc">Surface</span><span class="o">.</span><span class="na">ROTATION_180</span><span class="o">:</span> <span class="n">degrees</span> <span class="o">=</span> <span class="mi">180</span><span class="o">;</span> <span class="k">break</span><span class="o">;</span>  
        <span class="k">case</span> <span class="nc">Surface</span><span class="o">.</span><span class="na">ROTATION_270</span><span class="o">:</span> <span class="n">degrees</span> <span class="o">=</span> <span class="mi">270</span><span class="o">;</span> <span class="k">break</span><span class="o">;</span>  
    <span class="o">}</span>  
  
    <span class="kt">int</span> <span class="n">result</span><span class="o">;</span>  
    <span class="k">if</span> <span class="o">(</span><span class="n">info</span><span class="o">.</span><span class="na">facing</span> <span class="o">==</span> <span class="nc">Camera</span><span class="o">.</span><span class="na">CameraInfo</span><span class="o">.</span><span class="na">CAMERA_FACING_FRONT</span><span class="o">)</span> <span class="o">{</span>  
        <span class="n">result</span> <span class="o">=</span> <span class="o">(</span><span class="n">info</span><span class="o">.</span><span class="na">orientation</span> <span class="o">+</span> <span class="n">degrees</span><span class="o">)</span> <span class="o">%</span> <span class="mi">360</span><span class="o">;</span>  
        <span class="n">result</span> <span class="o">=</span> <span class="o">(</span><span class="mi">360</span> <span class="o">-</span> <span class="n">result</span><span class="o">)</span> <span class="o">%</span> <span class="mi">360</span><span class="o">;</span>  
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>  
        <span class="n">result</span> <span class="o">=</span> <span class="o">(</span><span class="n">info</span><span class="o">.</span><span class="na">orientation</span> <span class="o">-</span> <span class="n">degrees</span> <span class="o">+</span> <span class="mi">360</span><span class="o">)</span> <span class="o">%</span> <span class="mi">360</span><span class="o">;</span>  
    <span class="o">}</span>  
  
    <span class="n">camera</span><span class="o">.</span><span class="na">setDisplayOrientation</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>  
<span class="o">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">setCameraOrientation</code> 메서드는 <code class="language-plaintext highlighter-rouge">onSurfaceCreated</code> 메서드 안에서 호출되는 메서드이며 카메라 미리 보기 방향을 설정한다.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/android/'>Android</a>, <a href='/categories/multimedia/'>Multimedia</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/android/" class="post-tag no-text-decoration" >android</a> <a href="/tags/camera/" class="post-tag no-text-decoration" >camera</a> <a href="/tags/preview/" class="post-tag no-text-decoration" >preview</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=카메라에 미리보기 넣기 - Se Young&url=https://sey2.github.io/posts/CameraPreview/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=카메라에 미리보기 넣기 - Se Young&u=https://sey2.github.io/posts/CameraPreview/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=카메라에 미리보기 넣기 - Se Young&url=https://sey2.github.io/posts/CameraPreview/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div><script src="https://utteranc.es/client.js" repo="sey2/sey2.github.io" issue-term="pathname" theme="github-dark" crossorigin="anonymous" async> </script></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/basic4/">코틀린 기본 문법 (함수)</a><li><a href="/posts/back-13565/">백준 침투</a><li><a href="/posts/back-18352/">특정 거리의 도시 찾기 (18352)</a><li><a href="/posts/programmers-exam/">프로그래머스 모의고사</a><li><a href="/posts/programmers-rotto/">프로그래머스 로또의 최고 순위와 최저 순위</a></ul></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/CameraSaveImage/"><div class="card-body"> <em class="timeago small" date="2022-02-01 15:46:00 +0900" >Feb 1, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>카메라로 사진 찍어 저장하기</h3><div class="text-muted small"><p> 카메라로 사진 찍어 저장하기 카메라로 사진을 찍기 위해 사용되는 방법은 크게 두가지로 나눌 수 있다. 인텐트로 단말의 카메라 앱을 실행한 후 결과 사진을 받아 처리하기 앱 화면에 카메라 미리보기를 보여주고 직접 사진을 찍어 처리하기 스마트폰 단말에는 카메라 앱이 미리 설치되어 있는데 이 앱을 사용하면 가장 간단하게 다른 기능의 앱을 구...</p></div></div></a></div><div class="card"> <a href="/posts/PlayMusic/"><div class="card-body"> <em class="timeago small" date="2022-02-02 19:56:00 +0900" >Feb 2, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>음악 파일 재생하기</h3><div class="text-muted small"><p> 음악 파일 재생하기 멀티미디어를 위해 제공하는 미디어 API는 android.media 패키지에 들어 있다. 그 안의 클래스들 중에서 핵심이 되는 것은 MediaPlayer 클래스이다. 미디어 플레이어 클래스는 음악 파일과 같은 오디오의 재생은 물론 동영상 재생까지 담당한다. 출시되는 단말에 따라 지원하는 음성/영상 코덱이 다르므로 재생할 수 ...</p></div></div></a></div><div class="card"> <a href="/posts/PlayVideo/"><div class="card-body"> <em class="timeago small" date="2022-02-02 20:30:00 +0900" >Feb 2, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>동영상 재생하기</h3><div class="text-muted small"><p> 동영상 재생하기 동영상을 재생하고 싶으면 Video View 위젯을 사용하면 되는데 XML 레이아웃에 &amp;lt;Video View&amp;gt; 태그를 추가하기만 하면 동영상 플레이어를 바로 만들 수 있다. 동영상 화면에 디스플레이 되는 영역이 있으므로 위젯으로 XML 레이아웃에 추가할 수 있다. XML 레이아웃에 태그를 추가하고 한두줄의 코드만 구현...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/back-2606/" class="btn btn-outline-primary" prompt="Older"><p>백준 바이러스(2606)</p></a> <a href="/posts/PlayMusic/" class="btn btn-outline-primary" prompt="Newer"><p>음악 파일 재생하기</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://instagram.com/casio2978">Se Young Park</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/backjoon/">backjoon</a> <a class="post-tag" href="/tags/layout/">layout</a> <a class="post-tag" href="/tags/bfs/">BFS</a> <a class="post-tag" href="/tags/dfs/">DFS</a> <a class="post-tag" href="/tags/programmers/">programmers</a> <a class="post-tag" href="/tags/level1/">level1</a> <a class="post-tag" href="/tags/anroid/">anroid</a> <a class="post-tag" href="/tags/implements/">implements</a> <a class="post-tag" href="/tags/greedy/">greedy</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-M2M35DP38G"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-M2M35DP38G'); }); </script>
